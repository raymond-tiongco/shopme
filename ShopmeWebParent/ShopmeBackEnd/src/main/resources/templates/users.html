<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <title>Users</title>

    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" />
    <script type="text/javascript" th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

    <style>
        .divider:after,
        .divider:before {
        content: "";
        flex: 1;
        height: 1px;
        background: #eee;
        }

        .shopme-color {
            background-color: #ff4f00;
        }

        .white {color:#ffffff;}
        .left-align {text-align: left;}

        a:link { text-decoration: none; }

        a:visited { text-decoration: none; }

        a:hover { color: #ff4f00; }

        a:active { text-decoration: none; }

        .black-color {
            color: #000000;
        }

        .center {
            text-align: center;
        }

    </style>

    <link rel="shortcut icon" th:href="@{/images/shopme.svg}" type="image/x-icon">
    <link rel="icon" th:href="@{/images/shopme.svg}" type="image/x-icon">

</head>
<body>

<div th:replace="fragments :: symbols"></div>
<div th:replace="fragments :: header"></div>

<div class="container">
    <h3>Manage Users</h3>
    <a th:href="@{/AddUserForm}">Create New User</a>&nbsp;|&nbsp;
    <a th:href="@{/CsvExport}">Export to CSV</a>&nbsp;|&nbsp;
    <a th:href="@{/ExcelExport}">Export to Excel</a>&nbsp;|&nbsp;
    <a th:href="@{/PdfExport}">Export to PDF</a>
    <br>

    <form class="row gx-3 gy-2 align-items-center" action="#" th:action="@{/Search}" method="post" style="margin-top: 10px">
        <div class="col-auto">
            Filter:
        </div>
        <div class="col-sm-3">
            <input type="text" placeholder="Email keyword.." id="keyword" name="keyword" class="form-control">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn shopme-color white">Search</button>
        </div>
        <div class="col-auto">
            <a th:href="@{/Users}" class="btn btn-secondary">Clear</a>
        </div>
    </form>

    <div th:if="${isSearching}">
        [[${searchMessage}]]
    </div>

    <br>

    <div th:if="${alertMessage != null}" class="alert alert-success d-flex align-items-center" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
        <div>[[${alertMessage}]]</div>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="thead-dark">
            <tr>
                <th>
                    <a th:href="@{'/Users/'+${currentPage}+'/id?sortDir='+${reverseSortDir}}" class="black-color">User ID
                        <span th:if="${field != null}">
                            <span th:if="${field.equals('id')}">
                                <span th:if="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-down-fill"/></svg>
                                </span>
                                <span th:unless="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-up-fill"/></svg>
                                </span>
                            </span>
                        </span>
                    </a>
                </th>
                <th>Photos</th>
                <th>
                    <a th:href="@{'/Users/'+${currentPage}+'/email?sortDir='+${reverseSortDir}}" class="black-color">E-mail
                        <span th:if="${field != null}">
                            <span th:if="${field.equals('email')}">
                                <span th:if="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-down-fill"/></svg>
                                </span>
                                <span th:unless="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-up-fill"/></svg>
                                </span>
                            </span>
                        </span>
                    </a>
                </th>
                <th>
                    <a th:href="@{'/Users/'+${currentPage}+'/firstName?sortDir='+${reverseSortDir}}" class="black-color">First Name
                        <span th:if="${field != null}">
                            <span th:if="${field.equals('firstName')}">
                                <span th:if="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-down-fill"/></svg>
                                </span>
                                <span th:unless="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-up-fill"/></svg>
                                </span>
                            </span>
                        </span>
                    </a>
                </th>
                <th>
                    <a th:href="@{'/Users/'+${currentPage}+'/lastName?sortDir='+${reverseSortDir}}" class="black-color">Last Name
                        <span th:if="${field != null}">
                            <span th:if="${field.equals('lastName')}">
                                <span th:if="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-down-fill"/></svg>
                                </span>
                                <span th:unless="${reverseSortDir.equals('asc')}">
                                    <svg class="bi" width="24" height="24"><use xlink:href="#caret-up-fill"/></svg>
                                </span>
                            </span>
                        </span>
                    </a>
                </th>
                <th>Roles</th>
                <th>Enabled</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.id}" />
                <td class="center">
                    <img width="100px" height="100px" class='img-thumbnail'
                         th:src="@{/GetPhoto/{id}(id=${user.id})}" th:alt="${user.firstName}" />
                </td>
                <td th:text="${user.email}" />
                <td th:text="${user.firstName}"/>
                <td th:text="${user.lastName}"/>
                <td th:text="${user.roles}"/>
                <td th:switch="${user.enabled}" class="center">

                    <a href="#" th:case="1" data-bs-toggle="modal" th:data-bs-target="'#disableModal' + ${user.id}">
                        <svg class="bi" width="24" height="24"><use xlink:href="#check"/></svg>
                    </a>
                    <a href="#" th:case="0" data-bs-toggle="modal" th:data-bs-target="'#enableModal' + ${user.id}">
                        <svg class="bi" width="24" height="24"><use xlink:href="#cross"/></svg>
                    </a>

                    <div class="modal fade" th:id="'disableModal' + ${user.id}" tabindex="-1" aria-labelledby="disableModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="disableModalLabel">Disable Warning!</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to disable [[${user.firstName}]] [[${user.LastName}]]
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <a th:href="@{/Disable(userid=${user.id},page=${currentPage})}" class="btn btn-danger">Disable</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" th:id="'enableModal' + ${user.id}" tabindex="-1" aria-labelledby="enableModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="enableModalLabel">Enable Warning!</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to enable [[${user.firstName}]] [[${user.LastName}]]
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <a th:href="@{/Enable(userid=${user.id},page=${currentPage})}" class="btn btn-success">Enable</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </td>
                <td class="center">
                    <a th:href="@{/UpdateUserForm(userId=${user.id})}">
                        <svg class="bi" width="24" height="24"><use xlink:href="#penfill"/></svg>
                    </a>

                    <a href="#" data-bs-toggle="modal" th:data-bs-target="'#deleteModal' + ${user.id}">
                        <svg class="bi" width="24" height="24"><use xlink:href="#trash"/></svg>
                    </a>
                    <div class="modal fade" th:id="'deleteModal' + ${user.id}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteModalLabel">Delete Warning!</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to delete [[${user.firstName}]] [[${user.LastName}]]
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <a th:href="@{/DeleteUser(userId=${user.id})}" class="btn btn-danger">Delete</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </td>
            </tr>
        </tbody>
    </table>

    <div th:if="${!isSearching}">
        <footer class="panel-footer">
            <nav aria-label="Page navigation example">
                <div style="text-align: center">
                    Total Items: [[${totalItems}]] : Page [[${currentPage}]] of [[${totalPages}]]
                </div>

                <ul class="pagination justify-content-center">

                    <li class="page-item" th:if="${currentPage > 1}">
                        <a class="page-link" th:href="@{/Users/1}">First</a>
                    </li>
                    <li class="page-item disabled" th:unless="${currentPage > 1}">
                        <a class="page-link">First</a>
                    </li>

                    <li class="page-item" th:if="${currentPage > 1}">
                        <a class="page-link" th:href="@{'/Users/'+${currentPage - 1}}">Previous</a>
                    </li>
                    <li class="page-item disabled" th:unless="${currentPage > 1}">
                        <a class="page-link">Previous</a>
                    </li>

                    <span th:each="i: ${#numbers.sequence(1, totalPages)}">
                    <li class="page-item" th:if="${i != currentPage}">
                        <a class="page-link" th:href="@{'/Users/' + ${i}}">[[${i}]]</a>
                    </li>
                    <li class="page-item disabled" th:unless="${i != currentPage}">
                        <a class="page-link">[[${i}]]</a>
                    </li>
                </span>

                    <li class="page-item" th:if="${currentPage < totalPages}">
                        <a class="page-link" th:href="@{'/Users/'+${currentPage + 1}}">Next</a>
                    </li>
                    <li class="page-item disabled" th:unless="${currentPage < totalPages}">
                        <a class="page-link">Next</a>
                    </li>

                    <li class="page-item" th:if="${currentPage < totalPages}">
                        <a class="page-link" th:href="@{'/Users/'+${totalPages}}">Last</a>
                    </li>
                    <li class="page-item disabled" th:unless="${currentPage < totalPages}">
                        <a class="page-link">Last</a>
                    </li>
                </ul>
            </nav>
        </footer>
    </div>

</div>

<br>

<div th:replace="fragments :: footer"></div>

</body>
</html>